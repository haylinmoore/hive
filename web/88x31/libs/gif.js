(function(t){function e(t,i){if(({}).hasOwnProperty.call(e.cache,t))return e.cache[t];var n=e.resolve(t);if(!n)throw Error("Failed to resolve module "+t);var r={id:t,require:e,filename:t,exports:{},loaded:!1,parent:i,children:[]};i&&i.children.push(r);var s=t.slice(0,t.lastIndexOf("/")+1);return e.cache[t]=r.exports,n.call(r.exports,r,r.exports,s,t),r.loaded=!0,e.cache[t]=r.exports}e.modules={},e.cache={},e.resolve=function(t){return({}).hasOwnProperty.call(e.modules,t)?e.modules[t]:void 0},e.define=function(t,i){e.modules[t]=i};var i,n=(i="/",{title:"browser",version:"v21.5.0",browser:!0,env:{},argv:[],nextTick:t.setImmediate||function(t){setTimeout(t,0)},cwd:function(){return i},chdir:function(t){i=t}});e.define("/gif.coffee",function(t,i,n,r){var s,o,a,h,l;function f(t,e){return({}).hasOwnProperty.call(t,e)}a=e("events",t).EventEmitter,s=e("/browser.coffee",t),l=function(t){function e(t){var e,i;for(e in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),o)i=o[e],null!=this.options[e]?this.options[e]:this.options[e]=i}return function t(e,i){function n(){this.constructor=e}for(var r in i)f(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e}(e,t),o={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},h={delay:500,copy:!1},e.prototype.setOption=function(t,e){return this.options[t]=e,null!=this._canvas&&("width"===t||"height"===t)?this._canvas[t]=e:void 0},e.prototype.setOptions=function(t){var e,i;return(function(n){for(e in t)f(t,e)&&(i=t[e],n.push(this.setOption(e,i)));return n}).call(this,[])},e.prototype.addFrame=function(t,e){var i,n;for(n in null==e&&(e={}),(i={}).transparent=this.options.transparent,h)i[n]=e[n]||h[n];if(null!=this.options.width||this.setOption("width",t.width),null!=this.options.height||this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!=ImageData&&t instanceof ImageData)i.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?i.data=this.getContextData(t):i.context=t;else if(null!=t.childNodes)e.copy?i.data=this.getImageData(t):i.image=t;else throw Error("Invalid image");return this.frames.push(i)},e.prototype.render=function(){var t,e;if(this.running)throw Error("Already running");if(!(null!=this.options.width&&null!=this.options.height))throw Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(e){for(var i=(function(){var t;t=[];for(var e=0;0<=this.frames.length?e<this.frames.length:e>this.frames.length;0<=this.frames.length?++e:--e)t.push(e);return t}).apply(this,arguments),n=0,r=i.length;n<r;++n)t=i[n],e.push(null);return e}).call(this,[]),e=this.spawnWorkers();for(var i=(function(){var t;t=[];for(var i=0;0<=e?i<e:i>e;0<=e?++i:--i)t.push(i);return t}).apply(this,arguments),n=0,r=i.length;n<r;++n)t=i[n],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},e.prototype.abort=function(){for(var t;null!=(t=this.activeWorkers.shift());)console.log("killing active worker"),t.terminate();return this.running=!1,this.emit("abort")},e.prototype.spawnWorkers=function(){var t,e;return t=Math.min(this.options.workers,this.frames.length),(function(){var e;e=[];for(var i=this.freeWorkers.length;this.freeWorkers.length<=t?i<t:i>t;this.freeWorkers.length<=t?++i:--i)e.push(i);return e}).apply(this,arguments).forEach((e=this,function(t){var i,n;return console.log("spawning worker "+t),(i=new Worker(e.options.workerScript)).onmessage=(n=e,function(t){return n.activeWorkers.splice(n.activeWorkers.indexOf(i),1),n.freeWorkers.push(i),n.frameFinished(t.data)}),e.freeWorkers.push(i)})),t},e.prototype.frameFinished=function(t){return console.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,!function t(e,i){for(var n=0,r=i.length;n<r;++n)if(n in i&&null===i[n])return!0;return!1}(null,this.imageParts)?this.finishRendering():this.renderNextFrame()},e.prototype.finishRendering=function(){var t,e,i,n,r,s,o;r=0;for(var a=0,h=this.imageParts.length;a<h;++a)r+=((e=this.imageParts[a]).data.length-1)*e.pageSize+e.cursor;r+=e.pageSize-e.cursor,console.log("rendering finished - filesize "+Math.round(r/1e3)+"kb"),t=new Uint8Array(r),s=0;for(var l=0,f=this.imageParts.length;l<f;++l){e=this.imageParts[l];for(var p=0,u=e.data.length;p<u;++p)o=e.data[p],i=p,t.set(o,s),i===e.data.length-1?s+=e.cursor:s+=e.pageSize}return n=new Blob([t],{type:"image/gif"}),this.emit("finished",n,t)},e.prototype.renderNextFrame=function(){var t,e,i;if(0===this.freeWorkers.length)throw Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(t=this.frames[this.nextFrame++],i=this.freeWorkers.shift(),e=this.getTask(t),console.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(i),i.postMessage(e))},e.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},e.prototype.getImageData=function(t){var e;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(e=this._canvas.getContext("2d")).setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},e.prototype.getTask=function(t){var e,i;if(i={index:e=this.frames.indexOf(t),last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,preserveColors:this.options.preserveColors,repeat:this.options.repeat,canTransfer:"chrome"===s.name},null!=t.data)i.data=t.data;else if(null!=t.context)i.data=this.getContextData(t.context);else if(null!=t.image)i.data=this.getImageData(t.image);else throw Error("Invalid frame");return i},e}(a),t.exports=l}),e.define("/browser.coffee",function(t,e,i,n){var r,s,o,a,h;a=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),s="ie"===(h=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(r={name:"version"===h[1]?h[3]:h[1],version:s||parseFloat("opera"===h[1]&&h[4]?h[4]:h[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}})[r.name]=!0,r[r.name+parseInt(r.version,10)]=!0,r.platform[r.platform.name]=!0,t.exports=r}),e.define("events",function(t,e,i,r){n.EventEmitter||(n.EventEmitter=function(){});var s=e.EventEmitter=n.EventEmitter,o="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};s.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},s.prototype.emit=function(t){if("error"===t&&(!(this._events&&this._events.error)||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"!=typeof e){if(!o(e))return!1;for(var i=Array.prototype.slice.call(arguments,1),n=e.slice(),r=0,s=n.length;r<s;r++)n[r].apply(this,i);return!0}switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var i=Array.prototype.slice.call(arguments,1);e.apply(this,i)}return!0},s.prototype.addListener=function(t,e){if("function"!=typeof e)throw Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,e),this._events[t]){if(o(this._events[t])){if(!this._events[t].warned){var i;(i=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}this._events[t].push(e)}else this._events[t]=[this._events[t],e]}else this._events[t]=e;return this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(t,e){var i=this;return i.on(t,function n(){i.removeListener(t,n),e.apply(this,arguments)}),this},s.prototype.removeListener=function(t,e){if("function"!=typeof e)throw Error("removeListener only takes instances of Function");if(!(this._events&&this._events[t]))return this;var i=this._events[t];if(o(i)){var n=i.indexOf(e);if(n<0)return this;i.splice(n,1),0==i.length&&delete this._events[t]}else this._events[t]===e&&delete this._events[t];return this},s.prototype.removeAllListeners=function(t){return t&&this._events&&this._events[t]&&(this._events[t]=null),this},s.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),o(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}),t.GIF=e("/gif.coffee")}).call(this,this);